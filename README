CM7 TOPAZ BUILD INSTRUCTIONS
8/31/11


INSTRUCTIONS:

1.  Apply the following repo to .repo/local_manifest.xml

----cut----

<?xml version="1.0" encoding="UTF-8"?>
  <manifest>

  <remote  name="codeaurora"
           fetch="git://codeaurora.org"/>

  <remote  name = "privategh"
           fetch="git@github.com:" />

    <project path="device/hp/topaz"
      name="CyanogenMod/android_device_hp_topaz"
      remote="privategh"
      revision="gingerbread"/>

    <project path="device/htc/pyramid"
      name="CyanogenMod/android_device_htc_pyramid"
      remote="privategh"
      revision="master"/>

    <remove-project path="hardware/msm7k"
      name="CyanogenMod/android_hardware_msm7k"/>

    <project path="hardware/msm7k"
      name = "CyanogenMod/android_hardware_qsd8x60"
      remote="privategh"
      revision="gingerbread"/>

    <remove-project path="hardware/qcom/media"
      name="CyanogenMod/android_hardware_qcom_media"/>

    <project path="hardware/qcom/media/"
      name = "CyanogenMod/ninjas_hardware_qcom_media"
      remote="privategh"
      revision="gingerbread" />

    <remove-project path="frameworks/base"
      name="CyanogenMod/android_frameworks_base"/>

    <project path="frameworks/base"
      name = "CyanogenMod/ninjas_frameworks_base"
      remote="privategh"
      revision="gingerbread" />

    <!-- project path="hardware/qcom/media/mm-core"
     name = "platform/vendor/qcom-opensource/omx/mm-core"
     remote="codeaurora"
     revision="gingerbread_house"/ -->

  </manifest>


----cut----


2.  Add topaz to cyanogenmod's vendor tree

    croot
    cd vendor/cyanogenmod
    git apply (or add manually):

diff --git a/products/AndroidProducts.mk b/products/AndroidProducts.mk
index 3a927db..08015af 100644
--- a/products/AndroidProducts.mk
+++ b/products/AndroidProducts.mk
@@ -44,6 +44,7 @@ PRODUCT_MAKEFILES := \
     $(LOCAL_DIR)/cyanogen_smb_b9701.mk \
     $(LOCAL_DIR)/cyanogen_speedy.mk \
     $(LOCAL_DIR)/cyanogen_supersonic.mk \
+    $(LOCAL_DIR)/cyanogen_topaz.mk \
     $(LOCAL_DIR)/cyanogen_u8220.mk \
     $(LOCAL_DIR)/cyanogen_vega.mk \
     $(LOCAL_DIR)/cyanogen_vibrantmtd.mk \
diff --git a/vendorsetup.sh b/vendorsetup.sh
index cc7ea64..18f5810 100644
--- a/vendorsetup.sh
+++ b/vendorsetup.sh
@@ -43,6 +43,7 @@ add_lunch_combo cyanogen_smb_a1011-eng
 add_lunch_combo cyanogen_smb_b9701-eng
 add_lunch_combo cyanogen_speedy-eng
 add_lunch_combo cyanogen_supersonic-eng
+add_lunch_combo cyanogen_topaz-eng
 add_lunch_combo cyanogen_u8220-eng
 add_lunch_combo cyanogen_vega-eng
 add_lunch_combo cyanogen_vibrantmtd-eng

2b.  Create a new file at vendor/cyanogen/products/cyanogen_topaz.mk as follows:

------cut------

# Inherit AOSP device configuration for topaz.
$(call inherit-product, device/hp/topaz/device_topaz.mk)

# Inherit some common cyanogenmod stuff.
$(call inherit-product, vendor/cyanogen/products/common_full.mk)

#
# Setup device specific product configuration.
#
PRODUCT_NAME := cyanogen_topaz
PRODUCT_BRAND := hp
PRODUCT_DEVICE := topaz
PRODUCT_MODEL := HP Touchpad
PRODUCT_MANUFACTURER := hp
PRODUCT_BUILD_PROP_OVERRIDES += PRODUCT_NAME=topaz BUILD_ID=GRJ22 BUILD_DISPLAY_ID=GRJ90 BUILD_FINGERPRINT=google/passion/passion:2.3.4/GRJ22/121341:user/release-keys PRIVATE_BUILD_DESC="passion-user 2.3.4 GRJ22 121341 release-keys"

PRODUCT_PACKAGE_OVERLAYS += \
    vendor/cyanogen/overlay/tablet \
    vendor/cyanogen/overlay/topaz

#
# Set ro.modversion
#
ifdef CYANOGEN_NIGHTLY
    PRODUCT_PROPERTY_OVERRIDES += \
        ro.modversion=CyanogenMod-7-$(shell date +%m%d%Y)-NIGHTLY-topaz
else
    ifdef CYANOGEN_RELEASE
        PRODUCT_PROPERTY_OVERRIDES += \
            ro.modversion=CyanogenMod-7.1.0-RC1-topaz
    else
        PRODUCT_PROPERTY_OVERRIDES += \
            ro.modversion=CyanogenMod-7.1.0-RC1-topaz-KANG
    endif
endif


PRODUCT_COPY_FILES +=  \
    vendor/cyanogen/prebuilt/hdpi/media/bootanimation.zip:system/media/bootanimation.zip
------cut------


3.  Set up vendor tree.  Either:

    3a.  Run extract-files in device/hp/topaz to set up the vendor/hp/topaz directory

    Then, two files needed to be added (such as from the android dump):

    Into vendor/hp/topaz/proprietary:
         libaudioalsa.so
         libcamera.so

    3b.  Use the vendor repo.


4.  reposync, build and cross your fingers.

    croot
    repo sync -j16
    make clobber
    brunch topaz

    ...and see what happens.

Hopefully there will be something valuable in $OUT to play with.  Obviously the update.zip is not very useable yet.
But the sweet, sweet files should be inside.



WHAT TO DO IF THE BUILD BREAKS

Fix it.
